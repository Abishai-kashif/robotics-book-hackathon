# Render Blueprint for Robotics Textbook Backend
# This file enables Infrastructure as Code deployment on Render

services:
  # Backend API Service
  - type: web
    name: robotics-textbook-backend
    env: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free  # Change to 'starter' or 'standard' for production
    region: oregon  # Choose closest to your users: oregon, frankfurt, singapore
    branch: main  # Deploy from this git branch

    # Auto-deploy on git push
    autoDeploy: true

    # Health check endpoint
    healthCheckPath: /health

    # Environment variables (add sensitive values in Render Dashboard)
    envVars:
      - key: QDRANT_HOST
        value: qdrant-cluster  # Update if using external Qdrant

      - key: QDRANT_PORT
        value: 6333

      - key: EMBEDDING_MODEL
        value: all-MiniLM-L6-v2

      - key: OPENAI_API_KEY
        sync: false  # Set in Render Dashboard (sensitive)

      - key: GEMINI_API_KEY
        sync: false  # Set in Render Dashboard (sensitive)

      - key: PYTHON_VERSION
        value: 3.12.0

  # Qdrant Vector Database (Private Service)
  - type: pserv
    name: qdrant-cluster
    env: docker
    dockerCommand: ./qdrant
    plan: free  # Upgrade to 'starter' for persistent storage
    region: oregon

    # Use official Qdrant image
    image:
      url: docker.io/qdrant/qdrant:latest

    # Persistent disk for vector storage
    disk:
      name: qdrant-storage
      mountPath: /qdrant/storage
      sizeGB: 1  # Adjust based on content size (free tier: 1GB max)

    # Internal port
    ports:
      - name: http
        protocol: TCP
        port: 6333

      - name: grpc
        protocol: TCP
        port: 6334

# Optional: PostgreSQL for session storage (future enhancement)
# databases:
#   - name: chatbot-sessions
#     databaseName: chatbot_db
#     user: chatbot_user
#     plan: free
